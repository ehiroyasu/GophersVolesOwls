---
title: "Varied Parameter Simulations"
author: "Elizabeth Hiroyasu"
date: "November 22, 2016"
output: html_document
---

To look at the sensitivity of the prey population to the model parameters, we can run the model for a variety of different parameters and look how the curve changes. For this simulation, we will set a variety of r values for population runs.


```{r, echo=FALSE, warning=FALSE, message=FALSE}
setwd("../GophersVolesOwls")
library(devtools)
library(roxygen2)
load_all("owls")
library(owls)

library(deSolve)
library(plyr)
library(dplyr)
library(reshape)
library(ggplot2)
library(cowplot)
```

We can use the same pred_prey function created in our owls r-package, then use an ode solver to solve the derivatives.

The model requires multiple parameters:
r = growth rate of prey pop (gophers/season)
K_prey = carrying capacity of prey
alpha = attack rate of predator (or capture efficiency; the larger alpha is, the more the per capita growth rate of the prey population is depressed by the addition of a single predator)
beta= assimilation efficiency (efficiency of turning gophers into per capita growth)
delta = death rate of predator
k_max = maximum feeding rate (1/handling time)
D = half saturation constant (1/(alpha*handling time))

State variables:
N = starting population of prey 
P = starting population of predator


For this model, time is in terms of season (3 months), so each time interval is represented by a season and four seasons are equivalent to one year.
```{r}
#Parameters
alpha=1.68
beta = 0.002
delta=0.01
K_prey=175
h=1.39e-4
k_max=1/h
D=1/(alpha*h)
r=c(0.01, 0.75, 1.0, 1.90)
parameters <- c(r, alpha, beta, delta, K_prey, k_max, D)


#State variables:
N=c(175, 175, 175, 175, 175,
    100, 100, 100, 100, 100,
    50, 50, 50, 50, 50,
    25, 25, 25, 25, 25)

P=c(0.2, 0.4, 0.6, 0.95, 2.0, 
    0.2, 0.4, 0.6, 0.95, 2.0,
    0.2, 0.4, 0.6, 0.95, 2.0,
    0.2, 0.4, 0.6, 0.95, 2.0)
state<-cbind(N, P)
times<- seq(0, 20, by=1)
```

We can then run simulations for these various lists of r values while varying predator density.
```{r, echo=FALSE}
test_sim<-predprey_sim(times=times, state=state, r=r)
sim.df<-df_sim(sim=test_sim, r=r)

run<-sort(rep(1:80, times=21))
sim.df$run<-run

n175<-lsplit(sim=test_sim, n=1:5, r=r)
n175<-df_sim(sim=n175, r=r)

#finish writing plot_n function (still doesn't work with subset)
plot1<-plot_n(n175, r=0.01)
plot2<-plot_n(n175, r=0.75)
# plot2<- ggplot(data=subset(n175, r==0.75), aes(x=time, y=N, group=P, colour=P)) + geom_line(size=1.5)+ggtitle("r=0.75")
# 
# plot3<- ggplot(data=subset(n175, r==1.00), aes(x=time, y=N, group=P, colour=P)) + geom_line(size=1.5) +ggtitle("r=1.00")
# 
# plot4<- ggplot(data=subset(n175, r==1.90), aes(x=time, y=N, group=P, colour=P)) + geom_line(size=1.5) + ggtitle("r=1.90")

grid.arrange(plot1, plot2, plot3, plot4, ncol=2, top=textGrob("Prey Density over Time", gp=gpar(fontsize=20)))

n100<-lsplit(sim=test_sim, n=6:10, r=r)
n50<-lsplit(sim=test_sim, n=11:15, r=r)
n25<-lsplit(sim=test_sim, n=16:20, r=r)
```

#plot final N by parameter value