---
title: "Equilibrium Analysis"
output:
  pdf_document: default
  html_notebook: default
editor_options:
  chunk_output_type: inline
---

```{r, echo=FALSE, warning=FALSE, message=FALSE}
setwd("../GophersVolesOwls")
library(devtools)
library(roxygen2)
load_all("owls")
library(owls)
```

To study how we can expect the dynamics of the prey population to change in relation to the two parameters, we conducted a bifurcation analysis. This analysis allowed us to identify local equilibria and their stability as well as points where the system could transition between stability and instability. This allows us to determine points where the prey population transitions from coexistence to extinction or vice versa.

We explored the feasibility of using barn owls (_Tyto alba_) as a biocontrol for rodent pest species in an agricultural setting. The use of simple Lotka-Volterra predator-prey models reveals a relationship between the half-saturation constant (D) and carrying capacity (K_prey). The differential equations for the Lotka-Volterra predator-prey model is as follows:
\[\frac{dN}{dt}=rN(1-\frac{N}{K_{prey}})-\frac{k_{max}N}{N+D}P\]
\[\frac{dP}{dt}= 0\]

When examining the equilibrium value of N, we see there are three areas of interest.
```{r}
#Parameters
alpha=0.05
K_prey=1000
k_max=100
h=1/k_max
D=500#1/(alpha*h)
r=0.7 #avg vole growth rate
parameters <- c(r, alpha, K_prey, k_max, D)
P<-seq(0.1,2, by=0.01)

nstar_func<-function(parameters, P){
  Nstar_plus <- data.frame(((K_prey-D)+sqrt(((D-K_prey)^2)-(4*((k_max*K_prey*P)/r) - 
                                                              D*K_prey)))/2)
  Nstar_minus <-data.frame(((K_prey-D)-sqrt(((D-K_prey)^2)-(4*((k_max*K_prey*P)/r) - 
                                                            D*K_prey)))/2)
  Nstar<-data.frame(Nstar_plus, Nstar_minus)
  names(Nstar)<-c("Nstar_plus", "Nstar_minus")
  return(Nstar)
}

Nstar<-nstar_func(parameters, P)
Nstar_df<-data.frame(P, Nstar)

ggplot(Nstar_df) + 
  geom_line(aes(P, Nstar_plus)) + 
  geom_line(aes(P, Nstar_minus), linetype="dashed") +
  geom_hline(yintercept=0, linetype="dashed", color="red") +
  scale_x_continuous(expand= c(0,0)) + 
  labs(title="N* as a function of predator density", x="Predator density", y="N*") +
  annotate("rect", xmin=0.875, xmax=1.315, ymin=-Inf, ymax=Inf, fill="lightblue",alpha=0.2) +
  draw_label("I", 0.4, 250, hjust=0, vjust=0)+
  annotate("rect", xmin=0, xmax=0.875, ymin=-Inf, ymax=Inf, fill="forestgreen", alpha=0.2) +
  draw_label("II", 1.1, 250, hjust=0, vjust=0) + draw_label("III", 1.75, 250, hjust=0, 
                                                            vjust=0)
```


##Rescaled equilibrium solutions
Rescaling the prey equation and conducting parameter reduction we find the following
\[\frac{dN'}{dt'}=N'(1-N')-\frac{P'N'}{N'+D'}\]

Therefore the model has a steady state at (0,0)

When solving for the equilibrium value of N, we obtain the following solution:
\[N_{eq}=\frac{(1-D') \pm \sqrt{(D'-1)^2 + 4(P'-D')}}{2}\]

```{r}
nprime_func<-function(Pprime, Dprime){
  Nprime_plus <- data.frame(((1-Dprime)+sqrt(((Dprime-1)^2)-(4*(Pprime-Dprime))))/2)
  Nprime_minus <-data.frame(((1-Dprime)-sqrt(((Dprime-1)^2)-(4*(Pprime-Dprime))))/2)
  Nprime_star<-data.frame(Nprime_plus, Nprime_minus)
  names(Nprime_star)<-c("Nprime_plus", "Nprime_minus")
  return(Nprime_star)
}
```

We can then look at how the equilibrium changes as a function of varying P
```{r}
Pprime<-seq(0, 1, by=0.01)
Dprime<-0.5

NPeq<-data.frame(Pprime, nprime_func(Pprime, Dprime))

ggplot(NPeq) + 
  geom_line(aes(Pprime, Nprime_plus)) + 
  geom_line(aes(Pprime, Nprime_minus), linetype="dashed") +
  geom_hline(yintercept=0, linetype="dashed", color="red") +
  scale_x_continuous(expand= c(0,0)) + 
  labs(title="N'* as a function of predator density (D=0.5)", x="Predator density", y="N'*") #+
  #draw_label("I", 0.4, 0.5, hjust=0, vjust=0)+
  #annotate("rect", xmin=0, xmax=1, ymin=-Inf, ymax=Inf, fill="forestgreen", alpha=0.2) +
  #draw_label("II", 1.5, 0.5, hjust=0, vjust=0) +
  #annotate("rect", xmin=1, xmax=2, ymin=-Inf, ymax=Inf, fill="lightblue",alpha=0.2) 
```


Or we can examine how the equilibrium changes as a function of varying D
```{r}
Dprime<-seq(0, 1, by=0.01)
Pprime=0.5

NDeq<-data.frame(Dprime, nprime_func(Pprime, Dprime))

ggplot(NDeq) + 
  geom_line(aes(Dprime, Nprime_plus)) + 
  geom_line(aes(Dprime, Nprime_minus), linetype="dashed") +
  geom_hline(yintercept=0, linetype="dashed", color="red") +
  scale_x_continuous(expand= c(0,0)) + 
  labs(title="N'* as a function of predator density (P=0.5)", x="D", y="N'*")
```

```{r}
ggplot()+
  geom_line(data=NPeq, aes(Nprime_plus, Pprime)) +
  geom_line(data=NDeq, aes(Nprime_plus, Dprime))
```

